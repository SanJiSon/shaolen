# ๐ง ะะฐัััะพะนะบะฐ ั Nginx

ะัะปะธ ัั ะธัะฟะพะปัะทัะตัั Nginx ะดะปั ะพัะดะฐัะธ ััะฐัะธะบะธ, ัะพ `webapp_server.py` ะฝัะถะตะฝ **ัะพะปัะบะพ ะดะปั API endpoints**.

## ะััะธัะตะบัััะฐ:

```
โโโโโโโโโโโโโโโ
โ   Telegram  โ
โ    Bot      โ
โโโโโโโโฌโโโโโโโ
       โ
       โผ
โโโโโโโโโโโโโโโ      โโโโโโโโโโโโโโโโ
โ   Nginx     โโโโโโโถโ  Static      โ
โ  (Port 80)  โ      โ  Files       โ
โโโโโโโโฌโโโโโโโ      โ  (HTML/CSS/JS)โ
       โ             โโโโโโโโโโโโโโโโ
       โ
       โ API ะทะฐะฟัะพัั
       โผ
โโโโโโโโโโโโโโโ
โ  FastAPI    โ
โ  (Port 8000)โ
โ  API only   โ
โโโโโโโโโโโโโโโ
```

## ะะฐัััะพะนะบะฐ Nginx:

```nginx
server {
    listen 80;
    server_name your-domain.com;

    # ะกัะฐัะธัะตัะบะธะต ัะฐะนะปั (HTML, CSS, JS)
    location / {
        root /path/to/telegram_goals_bot/webapp;
        try_files $uri $uri/ /index.html;
        index index.html;
    }

    # API ะทะฐะฟัะพัั ะฟัะพะบัะธััะตะผ ะฝะฐ FastAPI
    location /api/ {
        proxy_pass http://127.0.0.1:8000;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }

    # ะกัะฐัะธะบะฐ (CSS, JS) ัะพะถะต ัะตัะตะท nginx
    location /static/ {
        root /path/to/telegram_goals_bot/webapp;
        expires 1y;
        add_header Cache-Control "public, immutable";
    }
}
```

## ะะฐะฟััะบ:

1. **Nginx** - ะพัะดะฐะตั ััะฐัะธะบั (ัะถะต ะฝะฐัััะพะตะฝ)
2. **FastAPI** - ัะพะปัะบะพ ะดะปั API:
   ```bash
   python3 webapp_server.py
   ```

## ะะฐะถะฝะพ:

- `WEBAPP_URL` ะฒ `.env` ะดะพะปะถะตะฝ ัะบะฐะทัะฒะฐัั ะฝะฐ ัะฒะพะน ะดะพะผะตะฝ (ะบะพัะพััะน ะพะฑัะปัะถะธะฒะฐะตั Nginx)
- **ะะฑัะทะฐัะตะปัะฝะพ:** Nginx ะดะพะปะถะตะฝ ะฟัะพะบัะธัะพะฒะฐัั ะทะฐะฟัะพัั `/api/` ะฝะฐ `http://127.0.0.1:8000`. ะะตะท ััะพะณะพ ะทะฐะฟัะพัั ะธะท WebApp ะฝะต ะดะพะนะดัั ะดะพ FastAPI, ะธ ะฒ ะปะพะณะฐั ะฒะตะฑ-ัะตัะฒะตัะฐ ะฝะธัะตะณะพ ะฝะต ะฟะพัะฒะธััั.
- ะกัะฐัะธะบะฐ ะพัะดะฐะตััั ะฝะฐะฟััะผัั ัะตัะตะท Nginx (ะฑััััะตะต)

## ะัะพะฒะตัะบะฐ, ััะพ API ะดะพัััะฟะตะฝ

**1. ะก ัะตัะฒะตัะฐ (ะดะพะปะถะตะฝ ะพัะฒะตัะธัั JSON):**
```bash
curl -s http://127.0.0.1:8000/api/health
# ะะถะธะดะฐะตััั: {"status":"ok","service":"goals-api"}
```

**2. ะงะตัะตะท Nginx (ั ัะพะณะพ ะถะต ัะตัะฒะตัะฐ ะธะปะธ ั ะฒะฝะตัะฝะตะณะพ ะฐะดัะตัะฐ):**
```bash
curl -s https://ะขะะะ-ะะะะะ/api/health
# ะะพะปะถะตะฝ ะฒะตัะฝััั ัะพั ะถะต JSON. ะัะปะธ 404 ะธะปะธ HTML โ ะฑะปะพะบ location /api/ ะฝะต ะฝะฐัััะพะตะฝ ะธะปะธ ะฝะต ะฟัะธะผะตะฝัะตััั.
```

**3. ะัะธ ะพัะบัััะธะธ WebApp ะฒ Telegram** ะฒ ะปะพะณะฐั `python3 webapp_server.py` ะดะพะปะถะฝั ะฟะพัะฒะปััััั ัััะพะบะธ:
```
๐ฅ GET /api/health - IP: ...
๐ฅ GET /api/user/123456/missions - IP: ...
ะะฐะฟัะพั ะผะธััะธะน ะดะปั ะฟะพะปัะทะพะฒะฐัะตะปั 123456
...
```
ะัะปะธ ะฟัะธ ะพัะบัััะธะธ WebApp ะฒ ะปะพะณะฐั **ะฝะธัะตะณะพ** ะฝะต ะฟะพัะฒะปัะตััั โ ะทะฐะฟัะพัั ะฝะต ะดะพัะพะดัั ะดะพ FastAPI. ะัะพะฒะตัั ะฒ Nginx ะบะพะฝัะธะณะต ะฝะฐะปะธัะธะต `location /api/ { proxy_pass http://127.0.0.1:8000; ... }` ะธ ะฟะตัะตะทะฐะณััะทะธ Nginx: `nginx -t && systemctl reload nginx`.

## ะฃะฟัะพัะตะฝะฝะฐั ะฒะตััะธั webapp_server.py (ัะพะปัะบะพ API):

ะัะปะธ ัะพัะตัั, ะผะพะถะฝะพ ัะฑัะฐัั ะธะท `webapp_server.py` ะฒัั, ััะพ ัะฒัะทะฐะฝะพ ัะพ ััะฐัะธะบะพะน, ะพััะฐะฒะธะฒ ัะพะปัะบะพ API endpoints. ะะพ ัะตะบััะฐั ะฒะตััะธั ัะพะถะต ัะฐะฑะพัะฐะตั - ะฟัะพััะพ ััะฐัะธะบะฐ ะฑัะดะตั ะธะณะฝะพัะธัะพะฒะฐัััั, ะตัะปะธ ะตั ะพัะดะฐะตั Nginx.
