<!DOCTYPE html>
<html lang="ru">
  <head>
    <meta charset="UTF-8" />
    <title>Goals WebApp</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
    <meta name="theme-color" content="#0f172a" />
    <link rel="stylesheet" href="styles.css?v=10" />
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0" rel="stylesheet" />
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.2/Sortable.min.js"></script>
  </head>
  <body>
    <script>
      (function() {
        var tg = window.Telegram && window.Telegram.WebApp;
        if (tg) {
          tg.ready();
          tg.expand();
          if (typeof tg.disableVerticalSwipes === "function") tg.disableVerticalSwipes();
          if (typeof tg.disableHorizontalSwipes === "function") tg.disableHorizontalSwipes();
          function hideMain() {
            try { if (tg.MainButton) tg.MainButton.hide(); } catch(e) {}
          }
          hideMain();
          var t = 0, id = setInterval(function() { hideMain(); t++; if (t > 50) clearInterval(id); }, 300);
          document.addEventListener('touchstart', hideMain, true);
          document.addEventListener('click', hideMain, true);
          var theme = tg.colorScheme || 'dark';
          document.documentElement.setAttribute('data-theme', theme);
          tg.onEvent('themeChanged', function() {
            document.documentElement.setAttribute('data-theme', tg.colorScheme || 'dark');
          });
          if (tg.backgroundColor) document.body.style.backgroundColor = tg.backgroundColor;
          if (tg.headerColor) document.documentElement.style.setProperty('--tg-theme-header-bg-color', tg.headerColor);
        }
      })();
    </script>
    <div id="app">
      <header class="app-header">
        <div class="app-header-row">
          <div class="app-header-text">
            <h1>–¢–≤–æ–∏ —Ü–µ–ª–∏</h1>
            <p class="subtitle">–ú–∏—Å—Å–∏–∏, —Ü–µ–ª–∏, –ø—Ä–∏–≤—ã—á–∫–∏ –∏ –∞–Ω–∞–ª–∏—Ç–∏–∫–∞</p>
          </div>
          <button type="button" id="settings-btn" class="icon-btn settings-header-btn" aria-label="–ù–∞—Å—Ç—Ä–æ–π–∫–∏" title="–ù–∞—Å—Ç—Ä–æ–π–∫–∏"><span class="material-symbols-outlined">settings</span></button>
          <button type="button" id="capsule-menu-btn" class="capsule-menu-btn" aria-label="–ö–∞–ø—Å—É–ª–∞ –≤—Ä–µ–º–µ–Ω–∏" title="–ö–∞–ø—Å—É–ª–∞ –≤—Ä–µ–º–µ–Ω–∏"><span class="capsule-icon-wrap"><img src="images/capsule-icon.png" alt="" class="capsule-icon-img" onerror="this.classList.add('failed')"><span class="capsule-icon-fallback">‚è≥</span></span></button>
        </div>
      </header>

      <nav class="tabs" role="tablist">
        <button type="button" class="tab active" data-tab="missions" role="tab" aria-selected="true">–ú–∏—Å—Å–∏–∏</button>
        <button type="button" class="tab" data-tab="goals" role="tab">–¶–µ–ª–∏</button>
        <button type="button" class="tab" data-tab="habits" role="tab">–ü—Ä–∏–≤—ã—á–∫–∏</button>
        <button type="button" class="tab" data-tab="analytics" role="tab">–ê–Ω–∞–ª–∏—Ç–∏–∫–∞</button>
        <button type="button" class="tab tab-profile" data-tab="profile" role="tab">–ü—Ä–æ—Ñ–∏–ª—å</button>
      </nav>

      <main class="tab-content">
        <section id="panel-missions" class="tab-panel active" role="tabpanel">
          <div class="panel-header">
            <h2>–ú–∏—Å—Å–∏–∏</h2>
            <div class="panel-header-actions">
              <button type="button" class="panel-edit-btn icon-btn" data-panel="missions" aria-label="–†–µ–∂–∏–º –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏—è" title="–†–µ–∂–∏–º –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏—è"><span class="material-symbols-outlined panel-edit-btn-icon">edit</span></button>
              <button type="button" id="add-mission-btn" class="primary-btn add-btn icon-btn" aria-label="–î–æ–±–∞–≤–∏—Ç—å –º–∏—Å—Å–∏—é"><span class="material-symbols-outlined">add</span></button>
            </div>
          </div>
          <div id="missions-list" class="cards"></div>
        </section>
        <section id="panel-goals" class="tab-panel" role="tabpanel">
          <div class="panel-header">
            <h2>–¶–µ–ª–∏</h2>
            <div class="panel-header-actions">
              <button type="button" class="panel-edit-btn icon-btn" data-panel="goals" aria-label="–†–µ–∂–∏–º –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏—è" title="–†–µ–∂–∏–º –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏—è"><span class="material-symbols-outlined panel-edit-btn-icon">edit</span></button>
              <button type="button" id="add-goal-btn" class="primary-btn add-btn icon-btn" aria-label="–î–æ–±–∞–≤–∏—Ç—å —Ü–µ–ª—å"><span class="material-symbols-outlined">add</span></button>
            </div>
          </div>
          <div id="goals-list" class="cards"></div>
        </section>
        <section id="panel-habits" class="tab-panel" role="tabpanel">
          <div class="panel-header">
            <h2>–ü—Ä–∏–≤—ã—á–∫–∏</h2>
            <div class="panel-header-actions">
              <button type="button" id="habit-calendar-btn" class="icon-btn" aria-label="–ö–∞–ª–µ–Ω–¥–∞—Ä—å –ø—Ä–∏–≤—ã—á–µ–∫" title="–ö–∞–ª–µ–Ω–¥–∞—Ä—å –ø—Ä–∏–≤—ã—á–µ–∫"><span class="material-symbols-outlined">calendar_month</span></button>
              <button type="button" class="panel-edit-btn icon-btn" data-panel="habits" aria-label="–†–µ–∂–∏–º –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏—è" title="–†–µ–∂–∏–º –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏—è"><span class="material-symbols-outlined panel-edit-btn-icon">edit</span></button>
              <button type="button" id="add-habit-btn" class="primary-btn add-btn icon-btn" aria-label="–î–æ–±–∞–≤–∏—Ç—å –ø—Ä–∏–≤—ã—á–∫—É"><span class="material-symbols-outlined">add</span></button>
            </div>
          </div>
          <div id="habits-list" class="cards"></div>
        </section>
        <section id="panel-analytics" class="tab-panel analytics-panel" role="tabpanel">
          <h2>–ê–Ω–∞–ª–∏—Ç–∏–∫–∞</h2>
          <div id="analytics-view" class="analytics"></div>
        </section>
        <section id="panel-profile" class="tab-panel" role="tabpanel">
          <div id="profile-view"></div>
        </section>
      </main>
    </div>

    <div id="settings-overlay" class="settings-overlay hidden">
      <div class="settings-overlay-backdrop"></div>
      <div class="settings-overlay-panel">
        <div class="settings-overlay-header">
          <h2>–ù–∞—Å—Ç—Ä–æ–π–∫–∏</h2>
          <button type="button" id="settings-overlay-close" class="settings-overlay-close" aria-label="–ó–∞–∫—Ä—ã—Ç—å">√ó</button>
        </div>
        <div id="settings-view" class="settings-view"></div>
      </div>
    </div>

    <div id="capsule-overlay" class="capsule-overlay hidden">
      <div class="capsule-overlay-backdrop"></div>
      <div class="capsule-overlay-panel">
        <div class="capsule-overlay-header">
          <h2>–ö–∞–ø—Å—É–ª–∞ –≤—Ä–µ–º–µ–Ω–∏</h2>
          <button type="button" id="capsule-overlay-close" class="capsule-overlay-close" aria-label="–ó–∞–∫—Ä—ã—Ç—å">√ó</button>
        </div>
        <div id="capsule-view" class="capsule-view"></div>
      </div>
    </div>

    <div id="habit-calendar-overlay" class="habit-calendar-overlay hidden">
      <div class="habit-calendar-backdrop"></div>
      <div class="habit-calendar-panel">
        <div class="habit-calendar-header">
          <button type="button" class="habit-calendar-prev icon-btn" aria-label="–ü—Ä–µ–¥—ã–¥—É—â–∏–π –º–µ—Å—è—Ü"><span class="material-symbols-outlined">chevron_left</span></button>
          <h2 id="habit-calendar-title">–Ø–Ω–≤–∞—Ä—å 2024</h2>
          <button type="button" class="habit-calendar-next icon-btn" aria-label="–°–ª–µ–¥—É—é—â–∏–π –º–µ—Å—è—Ü"><span class="material-symbols-outlined">chevron_right</span></button>
        </div>
        <div id="habit-calendar-view" class="habit-calendar-view"></div>
        <div class="habit-calendar-legend">
          <span class="habit-calendar-legend-item"><span class="habit-calendar-cell habit-calendar-cell-done intensity-4"></span> –í—ã–ø–æ–ª–Ω–µ–Ω–æ</span>
          <span class="habit-calendar-legend-item"><span class="habit-calendar-cell habit-calendar-cell-skip"></span> –ü—Ä–æ–ø—É—â–µ–Ω–æ</span>
          <span class="habit-calendar-legend-hint">–¶–≤–µ—Ç ‚Äî –∏–Ω—Ç–µ–Ω—Å–∏–≤–Ω–æ—Å—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è</span>
        </div>
        <button type="button" id="habit-calendar-close" class="habit-calendar-close" aria-label="–ó–∞–∫—Ä—ã—Ç—å">√ó</button>
      </div>
    </div>

    <button type="button" id="shaolen-fab" class="shaolen-fab" aria-label="–°–ø—Ä–æ—Å–∏—Ç—å —Å–æ–≤–µ—Ç–∞ —É –º–∞—Å—Ç–µ—Ä–∞ –®–∞–æ–ª–µ–Ω—å">
      <img src="images/shaolen-avatar.png" alt="" class="shaolen-fab-img" />
    </button>

    <div id="shaolen-overlay" class="shaolen-overlay hidden">
      <div id="shaolen-chat" class="shaolen-chat">
        <div class="shaolen-chat-header shaolen-swipe-area">
          <img src="images/shaolen-avatar.png" alt="" class="shaolen-header-avatar" />
          <h3>–ú–∞—Å—Ç–µ—Ä –®–∞–æ–ª–µ–Ω—å</h3>
          <span class="shaolen-usage"></span>
          <button type="button" class="shaolen-history-btn" aria-label="–ò—Å—Ç–æ—Ä–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤" title="–ò—Å—Ç–æ—Ä–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤">üìú</button>
          <button type="button" class="shaolen-fullscreen-btn" aria-label="–ù–∞ –≤–µ—Å—å —ç–∫—Ä–∞–Ω" title="–ù–∞ –≤–µ—Å—å —ç–∫—Ä–∞–Ω">‚õ∂</button>
          <button type="button" class="shaolen-restore-btn hidden" aria-label="–í–µ—Ä–Ω—É—Ç—å" title="–í–µ—Ä–Ω—É—Ç—å –ø–æ–ª–æ–∂–µ–Ω–∏–µ">‚Üò</button>
          <button type="button" class="shaolen-close" aria-label="–ó–∞–∫—Ä—ã—Ç—å">&times;</button>
        </div>
        <div id="shaolen-history-panel" class="shaolen-history-panel hidden">
          <div class="shaolen-history-header"><span>–ò—Å—Ç–æ—Ä–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤</span><button type="button" class="shaolen-history-close">&times;</button></div>
          <div class="shaolen-history-list"></div>
        </div>
        <div class="shaolen-messages"></div>
        <div class="shaolen-input-wrap">
          <div class="shaolen-attach-row">
            <input type="file" id="shaolen-image-input" class="shaolen-image-input" accept="image/*" aria-label="–ü—Ä–∏–∫—Ä–µ–ø–∏—Ç—å —Ñ–æ—Ç–æ" />
            <button type="button" class="shaolen-attach-btn" aria-label="–§–æ—Ç–æ" title="–ü—Ä–∏–∫—Ä–µ–ø–∏—Ç—å —Ñ–æ—Ç–æ">üì∑</button>
            <button type="button" class="shaolen-voice-btn" aria-label="–ó–∞–ø–∏—Å–∞—Ç—å –≥–æ–ª–æ—Å–æ–≤–æ–µ" title="–ó–∞–ø–∏—Å–∞—Ç—å –≥–æ–ª–æ—Å–æ–≤–æ–µ (—É–¥–µ—Ä–∂–∏–≤–∞–π—Ç–µ –∏–ª–∏ –Ω–∞–∂–º–∏—Ç–µ –µ—â—ë —Ä–∞–∑ –¥–ª—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∏)">üé§</button>
            <input type="file" id="shaolen-voice-input" class="shaolen-voice-input" accept="audio/webm,audio/ogg,audio/mp4,audio/mpeg,audio/mp3" aria-label="–ü—Ä–∏–∫—Ä–µ–ø–∏—Ç—å –∞—É–¥–∏–æ—Ñ–∞–π–ª" />
            <button type="button" class="shaolen-voice-attach-btn" aria-label="–ü—Ä–∏–∫—Ä–µ–ø–∏—Ç—å –∞—É–¥–∏–æ—Ñ–∞–π–ª" title="–ü—Ä–∏–∫—Ä–µ–ø–∏—Ç—å –≥–æ—Ç–æ–≤—ã–π –∞—É–¥–∏–æ—Ñ–∞–π–ª (–∑–∞–ø–∏—Å–∞–Ω–Ω—ã–π –≤ –¥—Ä—É–≥–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏)">üìé</button>
            <span class="shaolen-image-preview"></span>
            <span class="shaolen-voice-preview"></span>
          </div>
          <textarea id="shaolen-input" class="shaolen-input" placeholder="–ù–∞–ø–∏—à–∏—Ç–µ –≤–æ–ø—Ä–æ—Å –∏–ª–∏ –ø–æ–ø—Ä–æ—Å–∏—Ç–µ —Å–æ–≤–µ—Ç‚Ä¶ –ù–∞–ø—Ä–∏–º–µ—Ä: –æ—Ü–µ–Ω–∏ –∫–∞–ª–æ—Ä–∏–∏ –ø–æ —Ñ–æ—Ç–æ –µ–¥—ã" rows="3"></textarea>
          <button type="button" id="shaolen-send" class="shaolen-send primary-btn">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
        </div>
      </div>
    </div>

    <div id="capsule-open-overlay" class="capsule-open-overlay hidden">
      <div class="capsule-open-content">
        <h3>–ö–∞–ø—Å—É–ª–∞ –æ—Ç–∫—Ä—ã—Ç–∞</h3>
        <div id="capsule-open-body"></div>
        <button type="button" id="capsule-open-close" class="primary-btn">–ó–∞–∫—Ä—ã—Ç—å</button>
      </div>
      <canvas id="capsule-confetti-canvas"></canvas>
    </div>

    <div id="city-picker-overlay" class="city-picker-overlay hidden">
      <div class="city-picker-backdrop"></div>
      <div class="city-picker-panel">
        <div class="city-picker-header">
          <h3>–í—ã–±—Ä–∞—Ç—å –≥–æ—Ä–æ–¥</h3>
          <button type="button" id="city-picker-close" class="city-picker-close" aria-label="–ó–∞–∫—Ä—ã—Ç—å">&times;</button>
        </div>
        <input type="text" id="city-picker-search" class="input city-picker-search" placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –≥–æ—Ä–æ–¥–∞..." autocomplete="off" />
        <div id="city-picker-list" class="city-picker-list"></div>
      </div>
    </div>

    <div id="weight-trend-overlay" class="weight-trend-overlay hidden">
      <div class="weight-trend-backdrop"></div>
      <div class="weight-trend-panel">
        <div class="weight-trend-header">
          <h3>–¢–µ–Ω–¥–µ–Ω—Ü–∏—è –≤–µ—Å–∞</h3>
          <select id="weight-trend-period" class="weight-trend-period" aria-label="–ü–µ—Ä–∏–æ–¥">
            <option value="week">–ù–µ–¥–µ–ª—è</option>
            <option value="month">–ú–µ—Å—è—Ü</option>
            <option value="6months">–ü–æ–ª–≥–æ–¥–∞</option>
            <option value="year">–ì–æ–¥</option>
          </select>
          <button type="button" id="weight-trend-close" class="weight-trend-close" aria-label="–ó–∞–∫—Ä—ã—Ç—å">&times;</button>
        </div>
        <div id="weight-trend-chart" class="weight-trend-chart"></div>
      </div>
    </div>

    <div id="info-popup-backdrop" class="backdrop hidden">
      <div class="dialog info-popup-dialog">
        <h3 id="info-popup-title"></h3>
        <div id="info-popup-message" class="info-popup-message"></div>
        <div class="dialog-actions">
          <button type="button" id="info-popup-ok" class="primary-btn">OK</button>
        </div>
      </div>
    </div>

    <div id="achievement-popup-backdrop" class="backdrop achievement-popup-backdrop hidden">
      <div class="achievement-popup-dialog">
        <div class="achievement-popup-icon"><span class="material-symbols-outlined">emoji_events</span></div>
        <h3 class="achievement-popup-title">–î–æ—Å—Ç–∏–∂–µ–Ω–∏–µ —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–æ!</h3>
        <p id="achievement-popup-habit" class="achievement-popup-habit"></p>
        <p class="achievement-popup-message">–¢—ã –º–æ–ª–æ–¥–µ—Ü! 21 –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏–µ ‚Äî —ç—Ç–æ –æ—Ç–ª–∏—á–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç! –ü—Ä–æ–¥–æ–ª–∂–∞–π –≤ —Ç–æ–º –∂–µ –¥—É—Ö–µ! üí™‚ú®</p>
        <button type="button" id="achievement-popup-ok" class="primary-btn achievement-popup-btn">–û—Ç–ª–∏—á–Ω–æ!</button>
      </div>
    </div>

    <div id="dialog-backdrop" class="backdrop hidden">
      <div class="dialog">
        <form id="dialog-form" novalidate>
          <h3 id="dialog-title"></h3>
          <input id="dialog-title-input" class="input" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ" autocomplete="off" />
          <textarea id="dialog-description-input" class="input" placeholder="–û–ø–∏—Å–∞–Ω–∏–µ (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)" autocomplete="off"></textarea>
          <div id="dialog-extra"></div>
          <div class="dialog-actions">
            <button type="button" id="dialog-delete" class="danger-btn hidden" aria-label="–£–¥–∞–ª–∏—Ç—å">–£–¥–∞–ª–∏—Ç—å</button>
            <button type="button" id="dialog-cancel" class="secondary-btn">–û—Ç–º–µ–Ω–∞</button>
            <button type="submit" id="dialog-save" class="primary-btn">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
          </div>
        </form>
      </div>
    </div>

    <script src="app.js?v=9"></script>
  </body>
</html>
